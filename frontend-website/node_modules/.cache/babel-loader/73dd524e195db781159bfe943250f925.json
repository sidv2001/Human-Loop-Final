{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) r[k] = a[j];\n\n  return r;\n};\n\nimport React, { useRef, useEffect, useState, useImperativeHandle } from 'react';\nimport { createUseStyles } from 'react-jss';\nimport { v4 as uuid } from 'uuid';\nimport BBoxSelector from '../BBoxSelector';\nimport LabelBox from '../LabelBox';\nvar useStyles = createUseStyles({\n  bBoxAnnotator: {\n    cursor: 'crosshair'\n  },\n  imageFrame: {\n    position: 'relative',\n    backgroundSize: '100%'\n  }\n});\nvar BBoxAnnotator = React.forwardRef(function (_a, ref) {\n  var url = _a.url,\n      _b = _a.borderWidth,\n      borderWidth = _b === void 0 ? 2 : _b,\n      inputMethod = _a.inputMethod,\n      labels = _a.labels,\n      onChange = _a.onChange;\n  var classes = useStyles();\n\n  var _c = useState(null),\n      pointer = _c[0],\n      setPointer = _c[1];\n\n  var _d = useState(null),\n      offset = _d[0],\n      setOffset = _d[1];\n\n  var _e = useState([]),\n      entries = _e[0],\n      setEntries = _e[1];\n\n  var _f = useState(1),\n      multiplier = _f[0],\n      setMultiplier = _f[1];\n\n  useEffect(function () {\n    onChange(entries.map(function (entry) {\n      return {\n        width: Math.round(entry.width * multiplier),\n        height: Math.round(entry.height * multiplier),\n        top: Math.round(entry.top * multiplier),\n        left: Math.round(entry.left * multiplier),\n        label: entry.label\n      };\n    }));\n  }, [entries, multiplier]);\n\n  var _g = useState('free'),\n      status = _g[0],\n      setStatus = _g[1];\n\n  var _h = useState({}),\n      bBoxAnnotatorStyle = _h[0],\n      setBboxAnnotatorStyle = _h[1];\n\n  var _j = useState({}),\n      imageFrameStyle = _j[0],\n      setImageFrameStyle = _j[1];\n\n  var bBoxAnnotatorRef = useRef(null);\n  var labelInputRef = useRef(null);\n  useEffect(function () {\n    var _a;\n\n    var maxWidth = ((_a = bBoxAnnotatorRef.current) === null || _a === void 0 ? void 0 : _a.offsetWidth) || 1;\n    var imageElement = new Image();\n    imageElement.src = url;\n\n    imageElement.onload = function () {\n      var width = imageElement.width;\n      var height = imageElement.height;\n      setMultiplier(width / maxWidth);\n      setBboxAnnotatorStyle({\n        width: width / multiplier,\n        height: height / multiplier\n      });\n      setImageFrameStyle({\n        backgroundImageSrc: imageElement.src,\n        width: width / multiplier,\n        height: height / multiplier\n      });\n    };\n\n    imageElement.onerror = function () {\n      throw 'Invalid image URL: ' + url;\n    };\n  }, [url, multiplier, bBoxAnnotatorRef]);\n\n  var crop = function (pageX, pageY) {\n    return {\n      x: bBoxAnnotatorRef.current && imageFrameStyle.width ? Math.min(Math.max(Math.round(pageX - bBoxAnnotatorRef.current.offsetLeft), 0), Math.round(imageFrameStyle.width - 1)) : 0,\n      y: bBoxAnnotatorRef.current && imageFrameStyle.height ? Math.min(Math.max(Math.round(pageY - bBoxAnnotatorRef.current.offsetTop), 0), Math.round(imageFrameStyle.height - 1)) : 0\n    };\n  };\n\n  var updateRectangle = function (pageX, pageY) {\n    setPointer(crop(pageX, pageY));\n  };\n\n  useEffect(function () {\n    var mouseMoveHandler = function (e) {\n      switch (status) {\n        case 'hold':\n          updateRectangle(e.pageX, e.pageY);\n      }\n    };\n\n    window.addEventListener('mousemove', mouseMoveHandler);\n    return function () {\n      return window.removeEventListener('mousemove', mouseMoveHandler);\n    };\n  }, [status]);\n  useEffect(function () {\n    var mouseUpHandler = function (e) {\n      var _a;\n\n      switch (status) {\n        case 'hold':\n          updateRectangle(e.pageX, e.pageY);\n          setStatus('input');\n          (_a = labelInputRef.current) === null || _a === void 0 ? void 0 : _a.focus();\n      }\n    };\n\n    window.addEventListener('mouseup', mouseUpHandler);\n    return function () {\n      return window.removeEventListener('mouseup', mouseUpHandler);\n    };\n  }, [status, labelInputRef]);\n\n  var addEntry = function (label) {\n    setEntries(__spreadArrays(entries, [__assign(__assign({}, rect), {\n      label: label,\n      id: uuid(),\n      showCloseButton: false\n    })]));\n    setStatus('free');\n    setPointer(null);\n    setOffset(null);\n  };\n\n  var mouseDownHandler = function (e) {\n    switch (status) {\n      case 'free':\n      case 'input':\n        if (e.button !== 2) {\n          setOffset(crop(e.pageX, e.pageY));\n          setPointer(crop(e.pageX, e.pageY));\n          setStatus('hold');\n        }\n\n    }\n  };\n\n  var rectangle = function () {\n    var x1 = offset && pointer ? Math.min(offset.x, pointer.x) : 0;\n    var x2 = offset && pointer ? Math.max(offset.x, pointer.x) : 0;\n    var y1 = offset && pointer ? Math.min(offset.y, pointer.y) : 0;\n    var y2 = offset && pointer ? Math.max(offset.y, pointer.y) : 0;\n    return {\n      left: x1,\n      top: y1,\n      width: x2 - x1 + 1,\n      height: y2 - y1 + 1\n    };\n  };\n\n  useImperativeHandle(ref, function () {\n    return {\n      reset: function () {\n        setEntries([]);\n      }\n    };\n  });\n  var rect = rectangle();\n  return React.createElement(\"div\", {\n    className: classes.bBoxAnnotator,\n    style: {\n      width: bBoxAnnotatorStyle.width + \"px\",\n      height: bBoxAnnotatorStyle.height + \"px\"\n    },\n    ref: bBoxAnnotatorRef,\n    onMouseDown: mouseDownHandler\n  }, React.createElement(\"div\", {\n    className: classes.imageFrame,\n    style: {\n      width: imageFrameStyle.width + \"px\",\n      height: imageFrameStyle.height + \"px\",\n      backgroundImage: \"url(\" + imageFrameStyle.backgroundImageSrc + \")\"\n    }\n  }, status === 'hold' || status === 'input' ? React.createElement(BBoxSelector, {\n    rectangle: rect\n  }) : null, status === 'input' ? React.createElement(LabelBox, {\n    inputMethod: inputMethod,\n    top: rect.top + rect.height + borderWidth,\n    left: rect.left - borderWidth,\n    labels: labels,\n    onSubmit: addEntry,\n    ref: labelInputRef\n  }) : null, entries.map(function (entry, i) {\n    return React.createElement(\"div\", {\n      style: {\n        border: borderWidth + \"px solid rgb(255,0,0)\",\n        position: 'absolute',\n        top: entry.top - borderWidth + \"px\",\n        left: entry.left - borderWidth + \"px\",\n        width: entry.width + \"px\",\n        height: entry.height + \"px\",\n        color: 'rgb(255,0,0)',\n        fontFamily: 'monospace',\n        fontSize: 'small'\n      },\n      key: i,\n      onMouseOver: function () {\n        return setEntries(function (prevEntries) {\n          return prevEntries.map(function (e) {\n            return e.id === entry.id ? __assign(__assign({}, e), {\n              showCloseButton: true\n            }) : e;\n          });\n        });\n      },\n      onMouseLeave: function () {\n        return setEntries(function (prevEntries) {\n          return prevEntries.map(function (e) {\n            return e.id === entry.id ? __assign(__assign({}, e), {\n              showCloseButton: false\n            }) : e;\n          });\n        });\n      }\n    }, entry.showCloseButton ? React.createElement(\"div\", {\n      style: {\n        position: 'absolute',\n        top: '-8px',\n        right: '-8px',\n        width: '16px',\n        height: '0',\n        padding: '16px 0 0 0',\n        overflow: 'hidden',\n        color: '#fff',\n        backgroundColor: '#030',\n        border: '2px solid #fff',\n        borderRadius: '18px',\n        cursor: 'pointer',\n        userSelect: 'none',\n        textAlign: 'center'\n      },\n      onMouseDown: function (e) {\n        e.stopPropagation();\n      },\n      onClick: function () {\n        setEntries(entries.filter(function (e) {\n          return e.id !== entry.id;\n        }));\n      }\n    }, React.createElement(\"div\", {\n      style: {\n        display: 'block',\n        textAlign: 'center',\n        width: '16px',\n        position: 'absolute',\n        top: '-2px',\n        left: '0',\n        fontSize: '16px',\n        lineHeight: '16px',\n        fontFamily: '\"Helvetica Neue\", Consolas, Verdana, Tahoma, Calibri, ' + 'Helvetica, Menlo, \"Droid Sans\", sans-serif'\n      }\n    }, \"\\u00D7\")) : null, React.createElement(\"div\", {\n      style: {\n        overflow: 'hidden'\n      }\n    }, entry.label));\n  })));\n});\nexport default BBoxAnnotator;","map":{"version":3,"mappings":"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","names":["React","useRef","useEffect","useState","useImperativeHandle","createUseStyles","v4","uuid","BBoxSelector","LabelBox","useStyles","bBoxAnnotator","cursor","imageFrame","position","backgroundSize","BBoxAnnotator","forwardRef","_a","ref","url","_b","borderWidth","inputMethod","labels","onChange","classes","pointer","setPointer","offset","setOffset","entries","setEntries","multiplier","setMultiplier","map","entry","width","Math","round","height","top","left","label","status","setStatus","bBoxAnnotatorStyle","setBboxAnnotatorStyle","imageFrameStyle","setImageFrameStyle","bBoxAnnotatorRef","labelInputRef","maxWidth","current","offsetWidth","imageElement","Image","src","onload","backgroundImageSrc","onerror","crop","pageX","pageY","x","min","max","offsetLeft","y","offsetTop","updateRectangle","mouseMoveHandler","e","window","addEventListener","removeEventListener","mouseUpHandler","focus","addEntry","rect","id","showCloseButton","mouseDownHandler","button","rectangle","x1","x2","y1","y2","reset","className","style","onMouseDown","backgroundImage","onSubmit","i","border","color","fontFamily","fontSize","key","onMouseOver","prevEntries","__assign","onMouseLeave","right","padding","overflow","backgroundColor","borderRadius","userSelect","textAlign","stopPropagation","onClick","filter","display","lineHeight"],"sources":["/Users/sidvas/Desktop/Human-Loop-Mturk/frontend-website/node_modules/react-bbox-annotator/src/BBoxAnnotator/index.tsx"],"sourcesContent":["import React, { useRef, useEffect, useState, useImperativeHandle } from 'react';\nimport { createUseStyles } from 'react-jss';\nimport { v4 as uuid } from 'uuid';\nimport BBoxSelector from '../BBoxSelector';\nimport LabelBox from '../LabelBox';\n\nexport type EntryType = {\n    left: number;\n    top: number;\n    width: number;\n    height: number;\n    label: string;\n};\nconst useStyles = createUseStyles({\n    bBoxAnnotator: {\n        cursor: 'crosshair',\n    },\n    imageFrame: {\n        position: 'relative',\n        backgroundSize: '100%',\n    },\n});\ntype Props = {\n    url: string;\n    inputMethod: 'text' | 'select';\n    labels?: string | string[];\n    onChange: (entries: EntryType[]) => void;\n    borderWidth?: number;\n};\n\nconst BBoxAnnotator = React.forwardRef<any, Props>(({ url, borderWidth = 2, inputMethod, labels, onChange }, ref) => {\n    const classes = useStyles();\n    const [pointer, setPointer] = useState<{ x: number; y: number } | null>(null);\n    const [offset, setOffset] = useState<{ x: number; y: number } | null>(null);\n    const [entries, setEntries] = useState<\n        ({\n            id: string;\n            showCloseButton: boolean;\n        } & EntryType)[]\n    >([]);\n    const [multiplier, setMultiplier] = useState(1);\n    useEffect(() => {\n        onChange(\n            entries.map((entry) => ({\n                width: Math.round(entry.width * multiplier),\n                height: Math.round(entry.height * multiplier),\n                top: Math.round(entry.top * multiplier),\n                left: Math.round(entry.left * multiplier),\n                label: entry.label,\n            })),\n        );\n    }, [entries, multiplier]);\n    const [status, setStatus] = useState<'free' | 'input' | 'hold'>('free');\n    const [bBoxAnnotatorStyle, setBboxAnnotatorStyle] = useState<{ width?: number; height?: number }>({});\n    const [imageFrameStyle, setImageFrameStyle] = useState<{\n        width?: number;\n        height?: number;\n        backgroundImageSrc?: string;\n    }>({});\n\n    const bBoxAnnotatorRef = useRef<HTMLDivElement>(null);\n    const labelInputRef = useRef<HTMLDivElement>(null);\n    useEffect(() => {\n        const maxWidth = bBoxAnnotatorRef.current?.offsetWidth || 1;\n        const imageElement = new Image();\n        imageElement.src = url;\n        imageElement.onload = function () {\n            const width = imageElement.width;\n            const height = imageElement.height;\n            setMultiplier(width / maxWidth);\n            setBboxAnnotatorStyle({\n                width: width / multiplier,\n                height: height / multiplier,\n            });\n            setImageFrameStyle({\n                backgroundImageSrc: imageElement.src,\n                width: width / multiplier,\n                height: height / multiplier,\n            });\n        };\n        imageElement.onerror = function () {\n            throw 'Invalid image URL: ' + url;\n        };\n    }, [url, multiplier, bBoxAnnotatorRef]);\n\n    const crop = (pageX: number, pageY: number) => {\n        return {\n            x:\n                bBoxAnnotatorRef.current && imageFrameStyle.width\n                    ? Math.min(\n                          Math.max(Math.round(pageX - bBoxAnnotatorRef.current.offsetLeft), 0),\n                          Math.round(imageFrameStyle.width - 1),\n                      )\n                    : 0,\n            y:\n                bBoxAnnotatorRef.current && imageFrameStyle.height\n                    ? Math.min(\n                          Math.max(Math.round(pageY - bBoxAnnotatorRef.current.offsetTop), 0),\n                          Math.round(imageFrameStyle.height - 1),\n                      )\n                    : 0,\n        };\n    };\n    const updateRectangle = (pageX: number, pageY: number) => {\n        setPointer(crop(pageX, pageY));\n    };\n\n    useEffect(() => {\n        const mouseMoveHandler = (e: MouseEvent) => {\n            switch (status) {\n                case 'hold':\n                    updateRectangle(e.pageX, e.pageY);\n            }\n        };\n        window.addEventListener('mousemove', mouseMoveHandler);\n        return () => window.removeEventListener('mousemove', mouseMoveHandler);\n    }, [status]);\n\n    useEffect(() => {\n        const mouseUpHandler = (e: MouseEvent) => {\n            switch (status) {\n                case 'hold':\n                    updateRectangle(e.pageX, e.pageY);\n                    setStatus('input');\n                    labelInputRef.current?.focus();\n            }\n        };\n        window.addEventListener('mouseup', mouseUpHandler);\n        return () => window.removeEventListener('mouseup', mouseUpHandler);\n    }, [status, labelInputRef]);\n\n    const addEntry = (label: string) => {\n        setEntries([...entries, { ...rect, label, id: uuid(), showCloseButton: false }]);\n        setStatus('free');\n        setPointer(null);\n        setOffset(null);\n    };\n\n    const mouseDownHandler = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n        switch (status) {\n            case 'free':\n            case 'input':\n                if (e.button !== 2) {\n                    setOffset(crop(e.pageX, e.pageY));\n                    setPointer(crop(e.pageX, e.pageY));\n                    setStatus('hold');\n                }\n        }\n    };\n\n    const rectangle = () => {\n        const x1 = offset && pointer ? Math.min(offset.x, pointer.x) : 0;\n        const x2 = offset && pointer ? Math.max(offset.x, pointer.x) : 0;\n        const y1 = offset && pointer ? Math.min(offset.y, pointer.y) : 0;\n        const y2 = offset && pointer ? Math.max(offset.y, pointer.y) : 0;\n        return {\n            left: x1,\n            top: y1,\n            width: x2 - x1 + 1,\n            height: y2 - y1 + 1,\n        };\n    };\n\n    useImperativeHandle(ref, () => ({\n        reset() {\n            setEntries([]);\n        },\n    }));\n    const rect = rectangle();\n\n    return (\n        <div\n            className={classes.bBoxAnnotator}\n            style={{\n                width: `${bBoxAnnotatorStyle.width}px`,\n                height: `${bBoxAnnotatorStyle.height}px`,\n            }}\n            ref={bBoxAnnotatorRef}\n            onMouseDown={mouseDownHandler}\n        >\n            <div\n                className={classes.imageFrame}\n                style={{\n                    width: `${imageFrameStyle.width}px`,\n                    height: `${imageFrameStyle.height}px`,\n                    backgroundImage: `url(${imageFrameStyle.backgroundImageSrc})`,\n                }}\n            >\n                {status === 'hold' || status === 'input' ? <BBoxSelector rectangle={rect} /> : null}\n                {status === 'input' ? (\n                    <LabelBox\n                        inputMethod={inputMethod}\n                        top={rect.top + rect.height + borderWidth}\n                        left={rect.left - borderWidth}\n                        labels={labels}\n                        onSubmit={addEntry}\n                        ref={labelInputRef}\n                    />\n                ) : null}\n                {entries.map((entry, i) => (\n                    <div\n                        style={{\n                            border: `${borderWidth}px solid rgb(255,0,0)`,\n                            position: 'absolute',\n                            top: `${entry.top - borderWidth}px`,\n                            left: `${entry.left - borderWidth}px`,\n                            width: `${entry.width}px`,\n                            height: `${entry.height}px`,\n                            color: 'rgb(255,0,0)',\n                            fontFamily: 'monospace',\n                            fontSize: 'small',\n                        }}\n                        key={i}\n                        onMouseOver={() =>\n                            setEntries((prevEntries) =>\n                                prevEntries.map((e) => (e.id === entry.id ? { ...e, showCloseButton: true } : e)),\n                            )\n                        }\n                        onMouseLeave={() =>\n                            setEntries((prevEntries) =>\n                                prevEntries.map((e) => (e.id === entry.id ? { ...e, showCloseButton: false } : e)),\n                            )\n                        }\n                    >\n                        {entry.showCloseButton ? (\n                            <div\n                                style={{\n                                    position: 'absolute',\n                                    top: '-8px',\n                                    right: '-8px',\n                                    width: '16px',\n                                    height: '0',\n                                    padding: '16px 0 0 0',\n                                    overflow: 'hidden',\n                                    color: '#fff',\n                                    backgroundColor: '#030',\n                                    border: '2px solid #fff',\n                                    borderRadius: '18px',\n                                    cursor: 'pointer',\n                                    userSelect: 'none',\n                                    textAlign: 'center',\n                                }}\n                                onMouseDown={(e) => {\n                                    e.stopPropagation();\n                                }}\n                                onClick={() => {\n                                    setEntries(entries.filter((e) => e.id !== entry.id));\n                                }}\n                            >\n                                <div\n                                    style={{\n                                        display: 'block',\n                                        textAlign: 'center',\n                                        width: '16px',\n                                        position: 'absolute',\n                                        top: '-2px',\n                                        left: '0',\n                                        fontSize: '16px',\n                                        lineHeight: '16px',\n                                        fontFamily:\n                                            '\"Helvetica Neue\", Consolas, Verdana, Tahoma, Calibri, ' +\n                                            'Helvetica, Menlo, \"Droid Sans\", sans-serif',\n                                    }}\n                                >\n                                    &#215;\n                                </div>\n                            </div>\n                        ) : null}\n                        <div style={{ overflow: 'hidden' }}>{entry.label}</div>\n                    </div>\n                ))}\n            </div>\n        </div>\n    );\n});\nexport default BBoxAnnotator;\n"]},"metadata":{},"sourceType":"module"}